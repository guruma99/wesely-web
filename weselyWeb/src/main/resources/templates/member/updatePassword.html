<!DOCTYPE html>
<!-- Thymeleaf를 사용하겠다. -->
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>비밀번호 변경 페이지</title>


	<script src="/webjars/jquery/3.6.4/dist/jquery.min.js"></script>
	<script src="/webjars/axios/1.4.0/dist/axios.min.js"></script>
	<link rel="stylesheet" href="/css/font.css" />
	<link rel="stylesheet" href="/css/header.css" />
	<link rel="stylesheet" href="/css/style.css">
	<style type="text/css">
		#updatePassword {
			width: 350px;
			margin-right: auto;
			margin-left: auto;
			margin-top: 50px;
			padding: 20px;
			border: none;
			text-align: center;
		}
		
		table {
			width: 100%;
			margin: auto;
			padding: 15px;
		}

		td {
			padding: 5px;
		}
		
		#updatePassword .title {
			color: #4D54A5;
			font-weight: bold;
			font-size: 20px;
			text-align: left;
		}

		#updatePassword input {
			display: block;
			width: 100%;
			height: 35px;
			margin-top: 10px;
			margin-bottom: 10px;
			border: 1px solid gainsboro;
			border-radius: 7px;
			padding: 0 20px;
			/* 앞상하 뒷좌우 */
			box-sizing: border-box;
			font-size: 15px;
		}

		#updatePassword input:focus {
			border-color: #4D54A5;
			outline: none;
		}

		#updatePassword label {
			display: block;
			font-size: 14px;
			color: #333;
			text-align: left;
			margin-bottom: 5px;
		}



		#pwIcon {
			position: absolute;
			margin-left: 103px;
			margin-top: -37px;
		}

		#pw1Icon {
			position: absolute;
			margin-left: 103px;
			margin-top: -37px;
		}


		/* 변경완료 버튼 css */
		.updatePasswordBtn {
			width: 100%;
			height: 40px;
			border-radius: 7px;
			border: none;
			color: white;
			font-weight: bold;
			background-color: #4D54A5;
			margin-top: 10px;
			font-size: 15px;
			transition: all 0.3s;
		}

		.updatePasswordBtn:hover {
			transform: scale(1.03);
		}
	</style>
	<script>

		$(function () {

			// 새 비밀번호 유효성검사 | 영문/숫자/특수문자를 포함하여 8~20자
			$("#newPassword").keyup(function () {
				var pw = $("#newPassword").val();
				var pw1 = $("#password").val();
				var reg = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$/;
				if (pw.length >= 8 && pw.length <= 20) {
					if (!reg.test(pw)) {
						$("#newPwMessage").css('color', 'red').html("비밀번호는 영문/숫자/특수문자를 모두 포함해야합니다.");
					} else if (pw == pw1) {	// 현재 비밀번호와 동일한지 확인
						$("#newPwMessage").css('color', 'red').html("현재 비밀번호와 동일한 비밀번호가 입력되었습니다.");
					} else {
						$("#newPwMessage").css('color', 'green').html("사용가능한 비밀번호입니다.");
					}
				} else {
					$("#newPwMessage").css('color', 'red').html("비밀번호는 8자~20자로 작성해야합니다.");
				}
			});

			// 새 비밀번호 확인 검사
			$("#newPassword1").keyup(function () {
				var pw = $("#newPassword").val();
				var pw1 = $("#newPassword1").val();
				if (pw1 != null && pw1.length >= 1) {
					if (pw != pw1) {
						$("#newPwMessage1").css('color', 'red').html("비밀번호가 일치하지 않습니다.");
					} else {
						$("#newPwMessage1").css('color', 'green').html("비밀번호가 일치합니다.");
					}
				} else {
					$("#newPwMessage1").html(""); // 1자 미만이면 메세지 삭제
				}
			});


			// 새비밀번호 입력 보기/숨기기 구현
			$("#pwIcon").on("click", function () {
				if ($("#newPassword").attr("type") == "password") {
					$("#newPassword").attr("type", "text");
					$($(this)).attr('src', '/images/view.png');
				} else {
					$("#newPassword").attr("type", "password");
					$($(this)).attr('src', '/images/hide.png');
				}
			});
			// 새비밀번호 확인 보기/숨기기 구현
			$("#pw1Icon").on("click", function () {
				if ($("#newPassword1").attr("type") == "password") {
					$("#newPassword1").attr("type", "text");
					$($(this)).attr('src', '/images/view.png');
				} else {
					$("#newPassword1").attr("type", "password");
					$($(this)).attr('src', '/images/hide.png');
				}
			});

		});

		// 비밀번호 수정 확인하는 경고창 뜨게하는건 구현 완료
		// 현재 비밀번호 입력했을 때 저장되어있는 비밀번호랑 비교해서 다를 때 알림창을 구현해야함.

		function formCheck() {
			if ($("#password").val() == null || $("#password").val().trim().length == 0) {
				alert("현재 비밀번호는 반드시 입력해야 합니다.");
				$("#password").val("");
				$("#password").focus();
				return false;
			} else if ($("#newPassword").val() == null || $("#newPassword").val().trim().length == 0) {
				alert("새 비밀번호는 반드시 입력해야 합니다.");
				$("#newPassword").val("");
				$("#newPassword").focus();
				return false;
			} else if ($("#newPwMessage").css('color') != 'rgb(0, 128, 0)') {
				alert('새 비밀번호를 확인해주세요.');
				$("#newPassword").val("");
				$("#newPassword").focus();
				return false;
			} else if ($("#newPassword1").val() == null || $("#newPassword1").val().trim().length == 0) {
				alert("새 비밀번호는 반드시 입력해야 합니다.");
				$("#newPassword1").val("");
				$("#newPassword1").focus();
				return false;
			} else if ($("#newPwMessage1").css('color') != 'rgb(0, 128, 0)') {
				alert('새 비밀번호를 확인해주세요.');
				$("#newPassword1").val("");
				$("#newPassword1").focus();
				return false;
			} else if (window.confirm("비밀번호를 수정하시겠습니까? 다시 로그인해야합니다.")) {
				location.href = "/member/login";
			} else {
				return false;
			};
		}




	</script>
</head>

<body>
	<div class="wrapper">
		<header>
			<div class="logo">
				<a href="/">
					<img src="/images/weLogo.png" alt="Logo" />
				</a>
			</div>
			<nav class="bar">
				<a href="/store/"><strong>운동시설검색</strong></a>
				<a href="/community/"><strong>커뮤니티</strong></a>
				<a href="/"><strong>고객센터</strong></a>
			</nav>
			<nav class="login">
				<th:block th:if="${session.mvo == null}">
					<a href="/member/login"><strong>로그인</strong></a>
					<a href="/member/join"><strong>회원가입</strong></a>
				</th:block>
				<th:block th:if="${session.mvo != null}">
					<a href="/member/updateProfile"><strong>마이페이지</strong></a>
					<a href="/member/logout"><strong>로그아웃</strong></a>
					<a href="/"><strong>비즈니스 계정</strong></a>
				</th:block>
			</nav>
		</header>


		<div id="updatePassword">
			<form action="/member/updatePasswordOk" method="post" onsubmit="return formCheck()">
				<table id="editPwform">
					<tr>
						<td class="title">비밀번호 변경</td>
						<td class="image"><img src="/images/wesely_logo.png" alt="wesely로고" width="50px"></td>
					</tr>
					<tr>
						<td><br /></td>
					</tr>
					<tr>
						<td colspan="2">
							<input type="hidden" name="userid" th:value="${session.mvo.userid}">
							<label for="password">현재 비밀번호</label>
							<input type="text" id="password" name="password" />
						</td>
					</tr>
					<tr>
						<td colspan="2">
							<label for="password">새 비밀번호 입력</label>
							<input type="password" id="newPassword" name="newPassword" />
							<img id="pwIcon" src="/images/hide.png" width="20px">
							<span id="newPwMessage" style="float: left; font-size: 12px;" />
						</td>
					</tr>
					<tr>
						<td colspan="2">
							<label for="password">새 비밀번호 확인</label>
							<input type="password" id="newPassword1" />
							<img id="pw1Icon" src="/images/hide.png" width="20px">
							<span id="newPwMessage1" style="float: left; font-size: 12px;" />
						</td>
					</tr>


					<tr>
						<td colspan="2">
							<button type="submit" value="비밀번호변경완료" class="updatePasswordBtn">변경 완료</button> <br />
						</td>
					</tr>

				</table>
			</form>

		</div>
	</div>
</body>

</html>